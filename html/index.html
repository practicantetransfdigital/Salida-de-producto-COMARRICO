<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Salidas de Producto</title>
  <!-- Agregando Font Awesome para iconos profesionales -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <?!= HtmlService.createHtmlOutputFromFile('html/styles').getContent(); ?>
</head>
<body>
  <!-- PANTALLA DE LOGIN -->
  <div id="loginScreen" class="screen active">
    <div class="login-container">
      <div class="login-card">
        <div class="login-form">
          <div class="logo">
            <!-- Reemplazando emoji con icono Font Awesome -->
            <div class="logo-icon">
              <img src="https://comarrico.com/wp-content/uploads/2018/02/Logo-menu-comarrico.png" alt="COMARRICO" style="width: 160px;">
            </div>
            <h1>Salida de Productos</h1>
            <p>Gestión de Productos</p>
          </div>
          
          <form id="loginForm" onsubmit="return false;">
            <div class="form-group">
              <label for="usuario"><i class="fas fa-user"></i> Usuario</label>
              <input type="text" id="usuario" placeholder="Ingrese su usuario" required>
            </div>
            
            <div class="form-group">
              <label for="contrasena"><i class="fas fa-lock"></i> Contraseña</label>
              <input type="password" id="contrasena" placeholder="Ingrese su contraseña" required>
            </div>
            
            <button type="submit" class="btn btn-primary btn-block" onclick="iniciarSesion()">
              <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
            </button>
          </form>
          
          <div id="loginError" class="error-message" style="display: none;"></div>
        </div>
        
        <div class="login-image">
          <div class="login-image-content">
            <!-- Agregando icono al lado de bienvenida -->
            <i class="fas fa-warehouse" style="font-size: 64px; margin-bottom: 24px;"></i>
            <h2>Bienvenido</h2>
            <p>Sistema integral de gestión y control de salidas de producto</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- PANTALLA PRINCIPAL -->
  <div id="mainScreen" class="screen">
    <!-- NAVBAR -->
    <nav class="navbar">
      <div class="navbar-brand">
        <img src="https://comarrico.com/wp-content/uploads/2018/02/Logo-menu-comarrico.png" alt="COMARRICO" style="width: 50px;">
        <H3>SDP</H3>
      </div>
      
      <!-- Agregando menú de navegación con historial vencidos -->
      <div class="navbar-menu">
        <button class="nav-btn active" data-seccion="dashboard" id="btnDashboard" onclick="cargarDashboard()">
          <i class="fas fa-home"></i>
          <span>Dashboard</span>
        </button>
        <button class="nav-btn" data-seccion="vencidos" id="btnVencidos" onclick="refrescarVencidos()">
          <i class="fas fa-exclamation-triangle"></i>
          <span>Historial Vencidos</span>
          <span class="badge-count" id="contadorVencidos" style="display: none;">0</span>
        </button>
      </div>
      
      <div class="navbar-user">
        <i class="fas fa-user-circle" style="font-size: 20px; color: var(--gray-600);"></i>
        <span id="userName">Usuario</span>
        <span id="userRole" class="badge"></span>
        <button class="btn-icon" onclick="cerrarSesion()" title="Cerrar Sesión">
          <i class="fas fa-sign-out-alt"></i>
        </button>
      </div>
    </nav>

    <!-- CONTENIDO PRINCIPAL - DASHBOARD -->
    <main class="main-content" id="seccionDashboard">
      <!-- HEADER CON BOTÓN -->
      <div class="content-header">
        <div>
          <h2>Salida de productos - COMARRICO</h2>
          <p>Resumen y estadísticas de las salidas de los productos en comarrico</p>
        </div>
        <div style="display: flex; gap: 12px;">
          <!-- Agregando botón de refrescar sutil -->
          <button class="btn-icon" onclick="cargarDashboard()" title="Refrescar Dashboard" style="background: var(--white); border: 1px solid var(--gray-200); padding: 10px 16px; border-radius: 8px;">
            <i class="fas fa-sync-alt" style="color: var(--gray-600);"></i>
          </button>
          <button class="btn btn-primary" onclick="abrirModalRegistro()">
            <i class="fas fa-plus-circle"></i> Registrar Salida
          </button>
        </div>
      </div>

      <!-- TARJETAS DE ESTADÍSTICAS -->
      <div class="stats-grid">
        <!-- Reemplazando todos los emojis con iconos Font Awesome -->
        <div class="stat-card">
          <div class="stat-icon" style="background: #FFF4CC;">
            <i class="fas fa-chart-line" style="color: var(--primary-yellow);"></i>
          </div>
          <div class="stat-content">
            <h3 id="totalSalidas">0</h3>
            <p>Total de Salidas</p>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon" style="background: #FFE5B4;">
            <i class="fas fa-search" style="color: #F59E0B;"></i>
          </div>
          <div class="stat-content">
            <h3 id="enRevision">0</h3>
            <p>En Revisión</p>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon" style="background: #FFF8DC;">
            <i class="fas fa-check-circle" style="color: var(--success);"></i>
          </div>
          <div class="stat-content">
            <h3 id="devueltos">0</h3>
            <p>Devueltos</p>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon" style="background: #FFFACD;">
            <i class="fas fa-clock" style="color: var(--warning);"></i>
          </div>
          <div class="stat-content">
            <h3 id="pendientes">0</h3>
            <p>Pendientes</p>
          </div>
        </div>
      </div>

      <!-- GRÁFICOS -->
      <div class="charts-grid">
        <div class="chart-card">
          <h3><i class="fas fa-chart-pie"></i> Tipo de Salida</h3>
          <canvas id="chartTipoSalida"></canvas>
        </div>
        
        <div class="chart-card">
          <h3><i class="fas fa-bug"></i> Tipo de Plaga/Hallazgo</h3>
          <canvas id="chartTipoPlaga"></canvas>
        </div>
        
        <div class="chart-card">
          <h3><i class="fas fa-map-marker-alt"></i> Zonas con Mayor Frecuencia</h3>
          <canvas id="chartPasillo"></canvas>
        </div>
        
        <div class="chart-card">
          <h3><i class="fas fa-tasks"></i> Estado de Productos</h3>
          <canvas id="chartEstado"></canvas>
        </div>

      <div class="chart-card">
        <h3><i class="fas fa-crosshairs"></i> Sitios con Más Plagas</h3>
        <canvas id="chartPlagasPorUbicacion"></canvas>
      </div>
      </div>

      <!-- TABLA DE ÚLTIMOS REGISTROS -->
      <div class="table-container">
        <h3><i class="fas fa-history"></i> Últimos Movimientos</h3>
        <div class="table-responsive">
          <table id="tablaRegistros">
            <thead>
              <tr>
                <th><i class="fas fa-barcode"></i>  Código</th>
                <th><i class="fas fa-box"></i>  Producto</th>
                <th><i class="fas fa-tag"></i>  Tipo de Salida</th>
                <th><i class="fas fa-calendar"></i>  F. Retiro</th>
                <th><i class="fas fa-calendar"></i>  F. Retorno</th>
                <th><i class="fas fa-user"></i>  Responsable</th>
                <th><i class="fas fa-flag"></i>  Estado</th>
                <th><i class="fas fa-cog"></i>  Acciones</th>
              </tr>
            </thead>
            <tbody id="tablaRegistrosBody">
              <!-- Datos dinámicos -->
            </tbody>
          </table>
        </div>
      </div>
    </main>
    
    <!-- Nueva sección de Historial Vencidos -->
    <main class="main-content" id="seccionVencidos" style="display: none;">
      <!-- HEADER HISTORIAL VENCIDOS -->
      <div class="content-header">
        <div>
          <h2><i class="fas fa-exclamation-triangle" style="color: var(--error);"></i> Historial de Vencidos</h2>
          <p>Listado de productos con fecha de retorno vencida</p>
        </div>
        <div style="display: flex; gap: 12px;">
          <button class="btn-icon" onclick="refrescarVencidos()" title="Refrescar" style="background: var(--white); border: 1px solid var(--gray-200); padding: 10px 16px; border-radius: 8px;">
            <i class="fas fa-sync-alt" style="color: var(--gray-600);"></i>
          </button>
          <div class="filtro-vencidos">
            <select id="filtroVencidos" onchange="filtrarVencidos()" class="form-control-sm">
              <option value="todos">Todos los vencidos</option>
              <option value="hoy">Vencidos hoy</option>
              <option value="semana">Última semana</option>
              <option value="mes">Último mes</option>
            </select>
          </div>
        </div>
      </div>

      <!-- ESTADÍSTICAS RÁPIDAS DE VENCIDOS -->
      <div class="stats-grid stats-vencidos">
        <div class="stat-card stat-card-danger">
          <div class="stat-icon" style="background: rgba(239, 68, 68, 0.15);">
            <i class="fas fa-clock" style="color: var(--error);"></i>
          </div>
          <div class="stat-content">
            <h3 id="totalVencidos">0</h3>
            <p>Total Vencidos</p>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon" style="background: rgba(245, 158, 11, 0.15);">
            <i class="fas fa-hourglass-half" style="color: var(--warning);"></i>
          </div>
          <div class="stat-content">
            <h3 id="vencidosEnRevision">0</h3>
            <p>En Revisión</p>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon" style="background: rgba(59, 130, 246, 0.15);">
            <i class="fas fa-undo" style="color: var(--info);"></i>
          </div>
          <div class="stat-content">
            <h3 id="vencidosPendientes">0</h3>
            <p>Pend. Devolución</p>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon" style="background: rgba(239, 68, 68, 0.1);">
            <i class="fas fa-calendar-times" style="color: var(--error);"></i>
          </div>
          <div class="stat-content">
            <h3 id="diasPromedioVencido">0</h3>
            <p>Días Prom. Vencido</p>
          </div>
        </div>
      </div>

      <!-- TABLA DE VENCIDOS -->
      <div class="table-container">
        <div class="table-header-actions">
          <h3><i class="fas fa-list"></i> Registros Vencidos</h3>
          <div class="busqueda-vencidos">
            <i class="fas fa-search"></i>
            <input type="text" id="buscarVencido" placeholder="Buscar por código o producto..." onkeyup="buscarEnVencidos()">
          </div>
        </div>
        <div class="table-responsive">
          <table id="tablaVencidos">
            <thead>
              <tr>
                <th><i class="fas fa-barcode"></i> Código</th>
                <th><i class="fas fa-box"></i> Producto</th>
                <th><i class="fas fa-tag"></i> Tipo Salida</th>
                <th><i class="fas fa-calendar"></i> F. Retiro</th>
                <th><i class="fas fa-calendar-times"></i> F. Retorno</th>
                <th><i class="fas fa-hourglass-end"></i> Días Vencido</th>
                <th><i class="fas fa-user"></i> Responsable</th>
                <th><i class="fas fa-flag"></i> Estado</th>
                <th><i class="fas fa-cog"></i> Acciones</th>
              </tr>
            </thead>
            <tbody id="tablaVencidosBody">
              <!-- Datos dinámicos -->
            </tbody>
          </table>
        </div>
        
        <!-- Paginación -->
        <div class="paginacion-container" id="paginacionVencidos">
          <button class="btn-paginacion" onclick="paginaAnteriorVencidos()" id="btnAnteriorVencidos">
            <i class="fas fa-chevron-left"></i> Anterior
          </button>
          <span class="pagina-info" id="infoPaginaVencidos">Página 1 de 1</span>
          <button class="btn-paginacion" onclick="paginaSiguienteVencidos()" id="btnSiguienteVencidos">
            Siguiente <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </main>
  </div>

  <!-- MODAL DE REGISTRO -->
  <div id="modalRegistro" class="modal">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h2><i class="fas fa-clipboard-list"></i> Registrar Salida de Producto</h2>
        <button class="modal-close" onclick="cerrarModalRegistro()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <form id="formRegistro" onsubmit="return false;">
        <div class="form-grid">
          <div class="form-group">
            <label for="codigo"><i class="fas fa-barcode"></i> Código de Producto *</label>
            <input type="text" id="codigo" placeholder="Ingrese el Número" required>
          </div>

          <div class="form-group">
            <label for="nombreproducto"><i class="fas fa-box"></i> Nombre del producto *</label>
            <input type="text" id="nombreproducto" placeholder="" required>
          </div>
          
          <div class="form-group">
            <label for="descripcion"><i class="fas fa-file-alt"></i> Descripción *</label>
            <input type="text" id="descripcion" placeholder="Descripción del producto" required>
          </div>
          
          <div class="form-group">
            <label for="tipoSalida"><i class="fas fa-tag"></i> Tipo de Salida *</label>
            <select id="tipoSalida" required>
              <option value="">Seleccione...</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="tipoPlaga"><i class="fas fa-bug"></i> Tipo de Plaga/Hallazgo</label>
            <select id="tipoPlaga">
              <option value="N/A">N/A</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="responsable"><i class="fas fa-user"></i> Responsable del Retiro *</label>
            <input type="text" id="responsable" placeholder="Nombre del responsable" required>
          </div>
          
          <div class="form-group">
            <label for="pasillo"><i class="fas fa-map-marker-alt"></i> Pasillo/Ubicación *</label>
            <input type="text" id="pasillo" placeholder="Ingrese la ubicación" required>
          </div>
          
          <div class="form-group">
            <label for="fechaRetorno"><i class="fas fa-calendar-day"></i> Fecha Estimada de Retorno *</label>
            <input type="date" id="fechaRetorno" required>
          </div>
          
          <div class="form-group">
            <label for="estado"><i class="fas fa-flag"></i> Estado *</label>
            <select id="estado" required>
              <option value="">Seleccione...</option>
            </select>
          </div>
        </div>
        
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="cerrarModalRegistro()">
            <i class="fas fa-times"></i> Cancelar
          </button>
          <button type="submit" class="btn btn-primary" onclick="guardarRegistro()">
            <i class="fas fa-save"></i> Guardar Registro
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- LOADING SPINNER -->
  <div id="loadingSpinner" class="loading-spinner">
    <div class="spinner"></div>
    <p>Cargando...</p>
  </div>
  
  <!-- MODAL PARA VER DETALLES, EDITAR ESTADO Y VER HISTORIAL -->
  <div id="modalDetalles" class="modal">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h2><i class="fas fa-eye"></i> Detalles de Salida - <span id="tituloCodigo">Código</span></h2>
        <button class="modal-close" onclick="cerrarModalDetalles()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="modal-body">
        <!-- Pestañas para Detalles, Edición e Historial -->
        <div class="tabs">
          <button class="tab-btn active" onclick="cambiarPestania('detalles')">
            <i class="fas fa-info-circle"></i> Detalles
          </button>
          <button class="tab-btn" onclick="cambiarPestania('editar')">
            <i class="fas fa-edit"></i> Editar Estado
          </button>
          <button class="tab-btn" onclick="cambiarPestania('historial')">
            <i class="fas fa-history"></i> Historial
          </button>
        </div>
        
        <!-- Contenido de Detalles -->
        <div id="contenidoDetalles" class="tab-content active">
          <div class="detalles-grid">
            <!-- Información Básica -->
            <div class="detalle-grupo">
              <h3><i class="fas fa-info-circle"></i> Información Básica</h3>
              <div class="detalle-item">
                <label>ID de Registro:</label>
                <span id="detalleId" class="valor-detalle">-</span>
              </div>
              <div class="detalle-item">
                <label>Código:</label>
                <span id="detalleCodigo" class="valor-detalle">-</span>
              </div>
              <div class="detalle-item">
                <label>Nombre del Producto:</label>
                <span id="detalleNombre" class="valor-detalle">-</span>
              </div>
              <div class="detalle-item">
                <label>Descripción:</label>
                <span id="detalleDescripcion" class="valor-detalle">-</span>
              </div>
            </div>
            
            <!-- Tipo y Estado -->
            <div class="detalle-grupo">
              <h3><i class="fas fa-tags"></i> Clasificación</h3>
              <div class="detalle-item">
                <label>Tipo de Salida:</label>
                <span id="detalleTipoSalida" class="valor-detalle">-</span>
              </div>
              <div class="detalle-item">
                <label>Tipo de Plaga/Hallazgo:</label>
                <span id="detalleTipoPlaga" class="valor-detalle">-</span>
              </div>
              <div class="detalle-item">
                <label>Estado Actual:</label>
                <span id="detalleEstado" class="badge">-</span>
              </div>
              <div class="detalle-item">
                <label>Devuelto a:</label>
                <span id="detalledevuelto" class="valor-detalle">-</span>
              </div>
            </div>
            
            <!-- Responsable y Ubicación -->
            <div class="detalle-grupo">
              <h3><i class="fas fa-location-arrow"></i> Responsable y Ubicación</h3>
              <div class="detalle-item">
                <label>Responsable:</label>
                <span id="detalleResponsable" class="valor-detalle">-</span>
              </div>
              <div class="detalle-item">
                <label>Pasillo/Ubicación:</label>
                <span id="detallePasillo" class="valor-detalle">-</span>
              </div>
              <div class="detalle-item">
                <label>Estado de Vencimiento:</label>
                <span id="detalleEstadoVencimiento" class="valor-detalle">-</span>
              </div>
            </div>
            
            <!-- Fechas -->
            <div class="detalle-grupo">
              <h3><i class="fas fa-calendar-alt"></i> Fechas</h3>
              <div class="detalle-item">
                <label>Fecha y Hora de Retiro:</label>
                <span id="detalleFecha" class="valor-detalle">-</span>
              </div>
              <div class="detalle-item">
                <label>Registrado hace:</label>
                <span id="detalleTiempoTranscurrido" class="valor-detalle">-</span>
              </div>
              <div class="detalle-item">
                <label>Fecha Estimada de Retorno:</label>
                <span id="detalleFechaRetorno" class="valor-detalle">-</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Contenido de Edición -->
        <div id="contenidoEditar" class="tab-content">
          <div class="formulario-edicion">
            <div class="form-group">
              <label for="editarEstado"><i class="fas fa-flag"></i> Nuevo Estado *</label>
              <select id="editarEstado" class="form-control">
                <option value="">Seleccione nuevo estado...</option>
              </select>
            </div>
            
            <div class="resumen-cambio">
              <h4><i class="fas fa-sync-alt"></i> Resumen del Cambio</h4>
              <div class="cambio-estado">
                <span id="estadoActualTexto" class="badge badge-warning">En Revisión</span>
                <i class="fas fa-arrow-right"></i>
                <span id="estadoNuevoTexto" class="badge badge-info">Seleccione estado</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Contenido de Historial -->
        <div id="contenidoHistorial" class="tab-content">
          <div class="historial-container">
            <h3><i class="fas fa-exchange-alt"></i> Historial de Cambios de Estado</h3>
            
            <div id="listaObservaciones" class="lista-observaciones">
              <div class="cargando-historial">
                <i class="fas fa-spinner fa-spin"></i> Cargando historial...
              </div>
            </div>
            
            <div id="sinObservaciones" class="sin-observaciones" style="display: none;">
              <div class="mensaje-vacio">
                <i class="fas fa-inbox"></i>
                <p>No hay cambios de estado registrados</p>
                <small>Los cambios que realices aparecerán aquí</small>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="cerrarModalDetalles()">
          <i class="fas fa-times"></i> Cerrar
        </button>
        <button type="button" class="btn btn-primary" onclick="guardarCambioEstado()" id="btnGuardarCambio">
          <i class="fas fa-save"></i> Guardar Cambio
        </button>
      </div>
    </div>
  </div>
  
  <!-- MODAL CONFIRMACIÓN SIMPLE -->
  <div id="modalConfirmar" class="modal">
    <div class="modal-content modal-small">
      <div class="modal-body">
        <div style="text-align: center;padding: 30px; margin-top: -40px;">
          <i class="fas fa-question-circle" style="font-size: 48px; color: var(--warning); margin-bottom: 16px;"></i>
          <h3 style="margin-bottom: 16px; color: var(--gray-800);">Confirmar Cambio</h3>
          <p id="confirmarMensaje" style="color: var(--gray-600); margin-bottom: 24px; line-height: 1.5;">
            ¿Está seguro de realizar esta acción?
          </p>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="cancelarConfirmacion()">
          <i class="fas fa-times"></i> Cancelar
        </button>
        <button type="button" class="btn btn-primary" onclick="aceptarConfirmacion()">
          <i class="fas fa-check"></i> Aceptar
        </button>
      </div>
    </div>
  </div>

  <!-- MODAL EDICIÓN SIMPLIFICADO - Sin estado, con ubicación -->
<div id="modalEdicionCompleta" class="modal" style="display: none;">
  <div class="modal-content modal-lg">
    <div class="modal-header">
      <h3><i class="fas fa-edit"></i> Editar Salida de Producto</h3>
      <button class="modal-close" onclick="cerrarModalEdicion()">&times;</button>
    </div>
    
    <div class="modal-body">
      <div class="form-container">
        <form id="formEdicionCompleta" onsubmit="guardarEdicionCompleta(event)">
          
          <div class="form-row">
            <div class="form-group">
              <label for="editCodigo"><i class="fas fa-barcode"></i> Código *</label>
              <input type="text" id="editCodigo" class="form-control" required>
            </div>
            
            <div class="form-group">
              <label for="editNombreProducto"><i class="fas fa-cube"></i> Nombre del Producto *</label>
              <input type="text" id="editNombreProducto" class="form-control" required>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="editDescripcion"><i class="fas fa-file-alt"></i> Descripción *</label>
              <input type="text" id="editDescripcion" class="form-control" required>
            </div>
            
            <div class="form-group">
              <label for="editTipoSalida"><i class="fas fa-sign-out-alt"></i> Tipo de Salida *</label>
              <input type="text" id="editTipoSalida" class="form-control" required>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="editTipoPlaga"><i class="fas fa-bug"></i> Tipo de Plaga/Hallazgo</label>
              <input type="text" id="editTipoPlaga" class="form-control">
            </div>
            
            <div class="form-group">
              <label for="editResponsable"><i class="fas fa-user"></i> Responsable *</label>
              <input type="text" id="editResponsable" class="form-control" required>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="editPasillo"><i class="fas fa-map-marker-alt"></i> Pasillo/Ubicación *</label>
              <input type="text" id="editPasillo" class="form-control" required>
            </div>
            
            <div class="form-group">
              <label for="editFechaRetorno"><i class="fas fa-calendar-check"></i> Fecha Estimada de Retorno *</label>
              <input type="date" id="editFechaRetorno" class="form-control" required>
            </div>
          </div>
          
          <div class="form-row">
            <!-- REMOVIDO: Campo de Estado -->
            <div class="form-group">
              <label for="editFechaRetiro"><i class="fas fa-calendar-alt"></i> Fecha de Retiro *</label>
              <input type="datetime-local" id="editFechaRetiro" class="form-control" required>
            </div>
          </div>
          
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="cerrarModalEdicion()">
              <i class="fas fa-times"></i> Cancelar
            </button>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-save"></i> Guardar Cambios
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Devolución -->
<div id="modalDevolucion" class="modal">
  <div class="modal-content modal-medium">
    <div class="modal-header">
      <h2><i class="fas fa-undo-alt"></i> Registro de Devolución</h2>
      <button class="close-btn" onclick="cerrarModalDevolucion()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body" style="padding: 0 40px;">
      <div class="devolucion-info">
        <i class="fas fa-info-circle"></i>
        <span>Ingrese los datos de la persona que recibe el producto devuelto</span>
      </div>
      <div class="form-group">
        <label for="devueltoA"><i class="fas fa-user"></i> Devuelto a: <span class="required">*</span></label>
        <input type="text" id="devueltoA" placeholder="Nombre de quien recibe" required>
      </div>
      <div class="form-group">
        <label for="observacionDevolucion"><i class="fas fa-comment"></i> Observaciones:</label>
        <textarea id="observacionDevolucion" rows="3" placeholder="Observaciones adicionales (opcional)"></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="cerrarModalDevolucion()">
        <i class="fas fa-times"></i> Cancelar
      </button>
      <button class="btn btn-primary" onclick="confirmarDevolucion()">
        <i class="fas fa-check"></i> Confirmar Devolución
      </button>
    </div>
  </div>
</div>
  
  <?!= HtmlService.createHtmlOutputFromFile('functions/auth').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('functions/auxiliars').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('functions/confirmation').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('functions/dashboard').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('functions/details').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('functions/editstate').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('functions/Functform').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('functions/grafics').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('functions/initialization').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('functions/notifications').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('functions/observations').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('functions/tablehistory').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('functions/variables').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('functions/vencidos').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('functions/editmodal').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('functions/calculate').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('functions/normalization').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('functions/modaldevolution').getContent(); ?>

</body>
</html>
